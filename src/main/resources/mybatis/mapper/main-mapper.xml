<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.sist.web.mapper.MainMapper">
 
 	<resultMap type="com.sist.web.vo.GameVO" id="gameMap">
 	  <result property="tvo.stadium" column="stadium"/>
 	  <result property="tvo.logo_image" column="logo_image"/>
 	</resultMap>
 	
 	<select id="nextGameData" resultMap="gameMap">
 		SELECT g.game_id, g.round, g.home_score, g.away_score,
 			kickoff_date, kickoff_time,
 			g.home_team, g.away_team, t1.stadium, 
 			t1.logo_image AS home_logo, t2.logo_image AS away_logo 
 		FROM game g
 			JOIN team t1 ON home_team = t1.short_name
 			JOIN team t2 ON away_team = t2.short_name
 		WHERE status = ''
 		ORDER BY game_id ASC LIMIT 1
 	</select>
 	
 	<select id="gamePointTable" resultType="PointTableVO">
 		SELECT
		    team AS team,
		    t1.team_name,
		    t1.logo_image,
		    COUNT(*) AS P,    
		    SUM(win) AS W,
		    SUM(draw) AS D,
		    SUM(loss) AS L,
		    SUM(points) AS PTS
		FROM (
		    SELECT
		        home_team AS team,
		        CASE WHEN home_score &gt; away_score THEN 1 ELSE 0 END AS win,
		        CASE WHEN home_score = away_score THEN 1 ELSE 0 END AS draw,
		        CASE WHEN home_score &lt; away_score THEN 1 ELSE 0 END AS loss,
		        CASE
		            WHEN home_score &gt; away_score THEN 3
		            WHEN home_score = away_score THEN 1
		            ELSE 0
		        END AS points
		    FROM game
		    WHERE status = 'FE'         
		
		    UNION ALL
		
		    SELECT
		        away_team AS team,
		        CASE WHEN away_score &gt; home_score THEN 1 ELSE 0 END AS win,
		        CASE WHEN away_score = home_score THEN 1 ELSE 0 END AS draw,
		        CASE WHEN away_score &lt; home_score THEN 1 ELSE 0 END AS loss,
		        CASE
		            WHEN away_score &gt; home_score THEN 3
		            WHEN away_score = home_score THEN 1
		            ELSE 0
		        END AS points
		    FROM game
		    WHERE status = 'FE'
		) AS t
		JOIN team t1 
		ON t.team = t1.short_name 
		GROUP BY team, logo_image, team_name
		ORDER BY PTS DESC, W DESC;
 	</select>
 </mapper>